!function(i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof module&&module.exports?module.exports=function(t,e){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(t)),i(e),e}:i(jQuery)}(function(A){var L=function(t){var e=t.clone(!0,!0),i=t.find("canvas");i.length&&e.find("canvas").each(function(t){this.getContext("2d").drawImage(i.get(t),0,0)});return e};A.fn.quicksand=function(q,t){var H,S={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"call",adjustWidth:!1,useScaling:!1,enhancement:function(t){},selector:"> *",atomic:!1,dx:0,dy:0,maxWidth:0,retainExisting:!0};A.extend(S,t),void 0===A.transform&&(S.useScaling=!1),H="function"==typeof t?t:(arguments[2],arguments[2]);var N=this;return this.each(function(t){var n,f,r=[];f="function"==typeof S.attribute?A(q):L(A(q).filter("["+S.attribute+"]"));var e,i,l=A(this),s=A(this).css("height"),o=A(this).css("width"),h=!1,c=!1,a=A(l).offset(),p=[],d=A(this).find(S.selector),u=A(d).innerWidth();if(navigator.userAgent.match(/msie [6]/i))l.html("").append(f);else{var y=0,m=function(){if(A(this).css("margin","").css("position","").css("top","").css("left","").css("opacity",""),!y){if(y=1,!S.atomic){var s=l.find(S.selector);if(S.retainExisting){var a=A([]);w.find(S.selector).each(function(t){var e=A([]);if("function"==typeof S.attribute){var i=S.attribute(A(this));s.each(function(){if(S.attribute(this)==i)return e=A(this),!1})}else e=s.filter("["+S.attribute+'="'+A(this).attr(S.attribute)+'"]');0<e.length&&(a=a.add(e),0===t?l.prepend(e):e.insertAfter(l.find(S.selector).get(t-1)))}),s.not(a).remove()}else l.prepend(w.find(S.selector)),s.remove();h&&l.css("height",e),c&&l.css("width",o)}S.enhancement(l),"function"==typeof H&&H.call(N)}"auto"===S.adjustHeight&&l.css("height","auto"),"auto"===S.adjustWidth&&l.css("width","auto")},g=l.offsetParent(),b=g.offset();"relative"==g.css("position")?"body"!=g.get(0).nodeName.toLowerCase()&&(b.top+=parseFloat(g.css("border-top-width"))||0,b.left+=parseFloat(g.css("border-left-width"))||0):(b.top-=parseFloat(g.css("border-top-width"))||0,b.left-=parseFloat(g.css("border-left-width"))||0,b.top-=parseFloat(g.css("margin-top"))||0,b.left-=parseFloat(g.css("margin-left"))||0),isNaN(b.left)&&(b.left=0),isNaN(b.top)&&(b.top=0),b.left-=S.dx,b.top-=S.dy,!1!==S.adjustHeight&&l.css("height",A(this).height()),!1!==S.adjustWidth&&l.css("width",A(this).width()),d.each(function(t){p[t]=A(this).offset()}),A(this).stop();var v=0,x=0;d.each(function(t){A(this).stop();var e=A(this).get(0);x="absolute"==e.style.position?(v=-S.dx,-S.dy):(v=S.dx,S.dy),e.style.position="absolute",e.style.margin="0",S.adjustWidth||(e.style.width=u+"px"),e.style.top=p[t].top-parseFloat(e.style.marginTop)-b.top+x+"px",e.style.left=p[t].left-parseFloat(e.style.marginLeft)-b.left+v+"px",0<S.maxWidth&&p[t].left>S.maxWidth&&(e.style.display="none")});var w=L(A(l)),j=w.get(0);if(j.innerHTML="",j.setAttribute("id",""),j.style.height="auto",j.style.width=l.width()+"px",w.append(f),w.insertBefore(l),w.css("opacity",0),j.style.zIndex=-1,j.style.margin="0",j.style.position="absolute",j.style.top=a.top-b.top+"px",j.style.left=a.left-b.left+"px","dynamic"===S.adjustHeight?l.animate({height:w.height()},S.duration,S.easing):"call"===S.adjustHeight&&(e=w.height(),parseFloat(s)<parseFloat(e)?l.css("height",e):h=!0),"dynamic"===S.adjustWidth?l.animate({width:w.width()},S.duration,S.easing):"call"===S.adjustWidth&&(i=w.width(),parseFloat(o)<parseFloat(i)?l.css("width",i):c=!0),d.each(function(t){var e=[];"function"==typeof S.attribute?(n=S.attribute(A(this)),f.each(function(){if(S.attribute(this)==n)return e=A(this),!1})):e=f.filter("["+S.attribute+'="'+A(this).attr(S.attribute)+'"]'),e.length?S.useScaling?r.push({element:A(this),dest:e,style:{top:A(this).offset().top,left:A(this).offset().left,opacity:""},animation:{top:e.offset().top-b.top,left:e.offset().left-b.left,opacity:1,transform:"scale(1.0)"}}):r.push({element:A(this),dest:e,style:{top:A(this).offset().top,left:A(this).offset().left,opacity:""},animation:{top:e.offset().top-b.top,left:e.offset().left-b.left,opacity:1}}):S.useScaling?r.push({element:A(this),style:{top:A(this).offset().top,left:A(this).offset().left,opacity:""},animation:{opacity:"0.0",transform:"scale(0.0)"}}):r.push({element:A(this),style:{top:A(this).offset().top,left:A(this).offset().left,opacity:""},animation:{opacity:"0.0"}})}),f.each(function(t){var e,i=[],s=[];if("function"==typeof S.attribute?(n=S.attribute(A(this)),d.each(function(){if(S.attribute(this)==n)return i=A(this),!1}),f.each(function(){if(S.attribute(this)==n)return s=A(this),!1})):(i=d.filter("["+S.attribute+'="'+A(this).attr(S.attribute)+'"]'),s=f.filter("["+S.attribute+'="'+A(this).attr(S.attribute)+'"]')),0===i.length&&0<s.length){e=S.useScaling?{opacity:"1.0",transform:"scale(1.0)"}:{opacity:"1.0"};var a=L(s),o=a.get(0);o.style.position="absolute",o.style.margin="0",S.adjustWidth||(o.style.width=u+"px"),o.style.top=s.offset().top-b.top+"px",o.style.left=s.offset().left-b.left+"px",a.css("opacity",0),S.useScaling&&a.css("transform","scale(0.0)"),a.appendTo(l),(0===S.maxWidth||s.offset().left<S.maxWidth)&&r.push({element:A(a),dest:s,animation:e})}}),w.remove(),S.atomic){for($toDelete=l.find(S.selector),l.prepend(w.find(S.selector)),t=0;t<r.length;t++)if(r[t].dest&&r[t].style){var W=r[t].dest,F=W.offset();W.css({position:"relative",top:r[t].style.top-F.top,left:r[t].style.left-F.left}),W.animate({top:"0",left:"0"},S.duration,S.easing,m)}else r[t].element.animate(r[t].animation,S.duration,S.easing,m);$toDelete.remove()}else for(S.enhancement(l),t=0;t<r.length;t++)r[t].element.animate(r[t].animation,S.duration,S.easing,m)}})}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5xdWlja3NhbmQuanMiXSwibmFtZXMiOlsiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyb290IiwialF1ZXJ5IiwidW5kZWZpbmVkIiwid2luZG93IiwicmVxdWlyZSIsIiQiLCJjbG9uZVdpdGhDYW52YXNlcyIsImpxdWVyeU9iamVjdCIsImNsb25lZEpxdWVyeU9iamVjdCIsImNsb25lIiwiY2FudmFzZXMiLCJmaW5kIiwibGVuZ3RoIiwiZWFjaCIsImluZGV4IiwidGhpcyIsImdldENvbnRleHQiLCJkcmF3SW1hZ2UiLCJnZXQiLCJmbiIsInF1aWNrc2FuZCIsImNvbGxlY3Rpb24iLCJjdXN0b21PcHRpb25zIiwiY2FsbGJhY2tGdW5jdGlvbiIsIm9wdGlvbnMiLCJkdXJhdGlvbiIsImVhc2luZyIsImF0dHJpYnV0ZSIsImFkanVzdEhlaWdodCIsImFkanVzdFdpZHRoIiwidXNlU2NhbGluZyIsImVuaGFuY2VtZW50IiwiYyIsInNlbGVjdG9yIiwiYXRvbWljIiwiZHgiLCJkeSIsIm1heFdpZHRoIiwicmV0YWluRXhpc3RpbmciLCJleHRlbmQiLCJhcmd1bWVudHMiLCJ0aGF0IiwiaSIsInZhbCIsIiRjb2xsZWN0aW9uIiwiYW5pbWF0aW9uUXVldWUiLCJmaWx0ZXIiLCJkZXN0SGVpZ2h0IiwiZGVzdFdpZHRoIiwiJHNvdXJjZVBhcmVudCIsInNvdXJjZUhlaWdodCIsImNzcyIsInNvdXJjZVdpZHRoIiwiYWRqdXN0SGVpZ2h0T25DYWxsYmFjayIsImFkanVzdFdpZHRoT25DYWxsYmFjayIsIm9mZnNldCIsIm9mZnNldHMiLCIkc291cmNlIiwid2lkdGgiLCJpbm5lcldpZHRoIiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwibWF0Y2giLCJodG1sIiwiYXBwZW5kIiwicG9zdENhbGxiYWNrUGVyZm9ybWVkIiwicG9zdENhbGxiYWNrIiwiJHRvRGVsZXRlIiwiJGtlZXBFbGVtZW50cyIsIiRkZXN0IiwiJG1hdGNoZWRFbGVtZW50IiwiYXR0ciIsImFkZCIsInByZXBlbmQiLCJpbnNlcnRBZnRlciIsIm5vdCIsInJlbW92ZSIsImNhbGwiLCIkY29ycmVjdGlvblBhcmVudCIsIm9mZnNldFBhcmVudCIsImNvcnJlY3Rpb25PZmZzZXQiLCJub2RlTmFtZSIsInRvTG93ZXJDYXNlIiwidG9wIiwicGFyc2VGbG9hdCIsImxlZnQiLCJpc05hTiIsImhlaWdodCIsInN0b3AiLCJyYXdPYmoiLCJzdHlsZSIsInBvc2l0aW9uIiwibWFyZ2luIiwibWFyZ2luVG9wIiwibWFyZ2luTGVmdCIsImRpc3BsYXkiLCJyYXdEZXN0IiwiaW5uZXJIVE1MIiwic2V0QXR0cmlidXRlIiwiaW5zZXJ0QmVmb3JlIiwiekluZGV4IiwiYW5pbWF0ZSIsImRlc3RFbGVtZW50IiwicHVzaCIsImVsZW1lbnQiLCJkZXN0Iiwib3BhY2l0eSIsImFuaW1hdGlvbiIsInRyYW5zZm9ybSIsImFuaW1hdGlvbk9wdGlvbnMiLCJzb3VyY2VFbGVtZW50IiwiZCIsInJhd0Rlc3RFbGVtZW50IiwiYXBwZW5kVG8iLCJkZXN0T2Zmc2V0Il0sIm1hcHBpbmdzIjoiQ0FtQkMsU0FBVUEsR0FDYSxtQkFBWEMsUUFBeUJBLE9BQU9DLElBRXpDRCxPQUFPLENBQUMsVUFBV0QsR0FDUSxpQkFBWEcsUUFBdUJBLE9BQU9DLFFBRTlDRCxPQUFPQyxRQUFVLFNBQVVDLEVBQU1DLEdBYy9CLFlBYmdCQyxJQUFYRCxJQU1EQSxFQURxQixvQkFBWEUsT0FDREMsUUFBUSxVQUdSQSxRQUFRLFNBQVJBLENBQWtCSixJQUcvQkwsRUFBUU0sR0FDREEsR0FJVE4sRUFBUU0sUUF4QlosQ0EwQkUsU0FBVUksR0FDVixJQUFJQyxFQUFvQixTQUFTQyxHQUMvQixJQUFJQyxFQUFzQkQsRUFBYUUsT0FBTSxHQUFNLEdBQy9DQyxFQUFXSCxFQUFhSSxLQUFLLFVBQzdCRCxFQUFTRSxRQUNVSixFQUFtQkcsS0FBSyxVQUM5QkUsS0FBSyxTQUFTQyxHQUNiQyxLQUFLQyxXQUFXLE1BQ3RC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QUFHK0QsS0FDaENTLEVBQWFaLEVBQVkvQyxTQUU3QitDLEVBQVluRCxJQUFJLENBQ2R3QyxTQUFXLFdBQ1hSLElBQU90QyxFQUFlSCxHQUFHZ0QsTUFBTVAsSUFBTStCLEVBQVcvQixJQUNoREUsS0FBUXhDLEVBQWVILEdBQUdnRCxNQUFNTCxLQUFPNkIsRUFBVzdCLE9BR3BEaUIsRUFBWUQsUUFBUSxDQUFDbEIsSUFBTSxJQUFLRSxLQUFPLEtBQ25CN0QsRUFBUUMsU0FDUkQsRUFBUUUsT0FDUndDLFFBRXBCckIsRUFBZUgsR0FBRzhELFFBQVFILFFBQVF4RCxFQUFlSCxHQUFHaUUsVUFDbEJuRixFQUFRQyxTQUNSRCxFQUFRRSxPQUNSd0MsR0FHdENDLFVBQVVTLGNBNUJWLElBREFwRCxFQUFRTyxZQUFZa0IsR0FDZlAsRUFBSSxFQUFHQSxFQUFJRyxFQUFlakMsT0FBUThCLElBQ3JDRyxFQUFlSCxHQUFHOEQsUUFBUUgsUUFBUXhELEVBQWVILEdBQUdpRSxVQUFXbkYsRUFBUUMsU0FBVUQsRUFBUUUsT0FBUXdDIiwiZmlsZSI6ImpxdWVyeS5xdWlja3NhbmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG5cclxuUXVpY2tzYW5kIDEuNi4wXHJcblxyXG5SZW9yZGVyIGFuZCBmaWx0ZXIgaXRlbXMgd2l0aCBhIG5pY2Ugc2h1ZmZsaW5nIGFuaW1hdGlvbi5cclxuXHJcbkNvcHlyaWdodCAoYykgMjAxMCBKYWNlayBHYWxhbmNpYWsgKHJhem9yamFjay5uZXQpXHJcbkJpZyB0aGFua3MgZm9yIFBpb3RyIFBldHJ1cyAocmlkZGxlLnBsKSBmb3IgZGVlcCBjb2RlIHJldmlldyBhbmQgd29uZGVyZnVsIGRvY3MgJiBkZW1vcy5cclxuXHJcbkR1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIHZlcnNpb24gMiBsaWNlbnNlcy5cclxuaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3Jhem9yamFjay9xdWlja3NhbmQvbWFzdGVyL01JVC1MSUNFTlNFLnR4dFxyXG5odHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vcmF6b3JqYWNrL3F1aWNrc2FuZC9tYXN0ZXIvR1BMLUxJQ0VOU0UudHh0XHJcblxyXG5Qcm9qZWN0IHNpdGU6IGh0dHBzOi8vcmF6b3JqYWNrLm5ldC9xdWlja3NhbmRcclxuR2l0aHViIHNpdGU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yYXpvcmphY2svcXVpY2tzYW5kXHJcblxyXG4gKi9cclxuXHJcbi8vIFVzZXMgQ29tbW9uSlMsIEFNRCBvciBicm93c2VyIGdsb2JhbHMgdG8gY3JlYXRlIGEgalF1ZXJ5IHBsdWdpbi5cclxuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XHJcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLlxyXG4gICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xyXG4gIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcclxuICAgIC8vIE5vZGUvQ29tbW9uSlNcclxuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oIHJvb3QsIGpRdWVyeSApIHtcclxuICAgICAgaWYgKCBqUXVlcnkgPT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAvLyByZXF1aXJlKCdqUXVlcnknKSByZXR1cm5zIGEgZmFjdG9yeSB0aGF0IHJlcXVpcmVzIHdpbmRvdyB0b1xyXG4gICAgICAgIC8vIGJ1aWxkIGEgalF1ZXJ5IGluc3RhbmNlLCB3ZSBub3JtYWxpemUgaG93IHdlIHVzZSBtb2R1bGVzXHJcbiAgICAgICAgLy8gdGhhdCByZXF1aXJlIHRoaXMgcGF0dGVybiBidXQgdGhlIHdpbmRvdyBwcm92aWRlZCBpcyBhIG5vb3BcclxuICAgICAgICAvLyBpZiBpdCdzIGRlZmluZWQgKGhvdyBqcXVlcnkgd29ya3MpXHJcbiAgICAgICAgaWYgKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyApIHtcclxuICAgICAgICAgIGpRdWVyeSA9IHJlcXVpcmUoJ2pxdWVyeScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGpRdWVyeSA9IHJlcXVpcmUoJ2pxdWVyeScpKHJvb3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBmYWN0b3J5KGpRdWVyeSk7XHJcbiAgICAgIHJldHVybiBqUXVlcnk7XHJcbiAgICB9O1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBCcm93c2VyIGdsb2JhbHNcclxuICAgIGZhY3RvcnkoalF1ZXJ5KTtcclxuICB9XHJcbn0oZnVuY3Rpb24gKCQpIHtcclxuICB2YXIgY2xvbmVXaXRoQ2FudmFzZXMgPSBmdW5jdGlvbihqcXVlcnlPYmplY3QpIHtcclxuICAgIHZhciBjbG9uZWRKcXVlcnlPYmplY3QgPSAganF1ZXJ5T2JqZWN0LmNsb25lKHRydWUsIHRydWUpO1xyXG4gICAgdmFyIGNhbnZhc2VzID0ganF1ZXJ5T2JqZWN0LmZpbmQoJ2NhbnZhcycpO1xyXG4gICAgaWYgKGNhbnZhc2VzLmxlbmd0aCkge1xyXG4gICAgICB2YXIgY2xvbmVkQ2FudmFzZXMgPSBjbG9uZWRKcXVlcnlPYmplY3QuZmluZCgnY2FudmFzJyk7XHJcbiAgICAgIGNsb25lZENhbnZhc2VzLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcclxuICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShjYW52YXNlcy5nZXQoaW5kZXgpLCAwLCAwKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2xvbmVkSnF1ZXJ5T2JqZWN0O1xyXG4gIH07XHJcblxyXG4gICQuZm4ucXVpY2tzYW5kID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgY3VzdG9tT3B0aW9ucykge1xyXG4gICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgIGR1cmF0aW9uIDogNzUwLFxyXG4gICAgICBlYXNpbmcgOiAnc3dpbmcnLFxyXG4gICAgICBhdHRyaWJ1dGUgOiAnZGF0YS1pZCcsICAgICAgICAvLyBhdHRyaWJ1dGUgdG8gcmVjb2duaXplIHNhbWUgaXRlbXMgd2l0aGluIHNvdXJjZSBhbmQgZGVzdFxyXG4gICAgICBhZGp1c3RIZWlnaHQgOiAnY2FsbCcsICAgICAgICAvLyAnZHluYW1pYycgYW5pbWF0ZXMgaGVpZ2h0IGR1cmluZyBzaHVmZmxpbmcgKHNsb3cpLCAnY2FsbCcgYWRqdXN0cyBpdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgb3IgYWZ0ZXIgdGhlIGFuaW1hdGlvbiwgZmFsc2UgbGVhdmVzIGhlaWdodCBhbG9uZSwgJ2F1dG8nIHNldHMgaXQgdG8gYXV0b1xyXG4gICAgICBhZGp1c3RXaWR0aCA6IGZhbHNlLCAgICAgICAgICAvLyAnZHluYW1pYycgYW5pbWF0ZXMgd2lkdGggZHVyaW5nIHNodWZmbGluZyAoc2xvdyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICdjYWxsJyBhZGp1c3RzIGl0IGJlZm9yZSBvciBhZnRlciB0aGUgYW5pbWF0aW9uLCBmYWxzZSBsZWF2ZXMgdGhlIHdpZHRoIGFsb25lLCAnYXV0bycgc2V0cyBpdCB0byBhdXRvXHJcbiAgICAgIHVzZVNjYWxpbmcgOiBmYWxzZSwgICAgICAgICAgIC8vIGVuYWJsZSBpdCBpZiB5b3UncmUgdXNpbmcgc2NhbGluZyBlZmZlY3RcclxuICAgICAgZW5oYW5jZW1lbnQgOiBmdW5jdGlvbihjKSB7fSwgLy8gVmlzdWFsIGVuaGFjZW1lbnQgKGVnLiBmb250IHJlcGxhY2VtZW50KSBmdW5jdGlvbiBmb3IgY2xvbmVkIGVsZW1lbnRzXHJcbiAgICAgIHNlbGVjdG9yIDogJz4gKicsXHJcbiAgICAgIGF0b21pYyA6IGZhbHNlLFxyXG4gICAgICBkeCA6IDAsXHJcbiAgICAgIGR5IDogMCxcclxuICAgICAgbWF4V2lkdGggOiAwLFxyXG4gICAgICByZXRhaW5FeGlzdGluZyA6IHRydWUgICAgICAgICAvLyBkaXNhYmxlIGlmIHlvdSB3YW50IHRoZSBjb2xsZWN0aW9uIG9mIGl0ZW1zIHRvIGJlIHJlcGxhY2VkIGNvbXBsZXRlbHkgYnkgaW5jb21pbmcgaXRlbXMuXHJcbiAgICB9O1xyXG5cclxuICAgICQuZXh0ZW5kKG9wdGlvbnMsIGN1c3RvbU9wdGlvbnMpO1xyXG5cclxuICAgIGlmICgodHlwZW9mICgkLnRyYW5zZm9ybSkgPT0gJ3VuZGVmaW5lZCcpKSB7XHJcbiAgICAgIG9wdGlvbnMudXNlU2NhbGluZyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBjYWxsYmFja0Z1bmN0aW9uO1xyXG4gICAgaWYgKHR5cGVvZiAoYXJndW1lbnRzWzFdKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNhbGxiYWNrRnVuY3Rpb24gPSBhcmd1bWVudHNbMV07XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiAoYXJndW1lbnRzWzJdID09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgIGNhbGxiYWNrRnVuY3Rpb24gPSBhcmd1bWVudHNbMl07XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRoYXQgPSB0aGlzO1xyXG4gICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKSB7XHJcbiAgICAgIHZhciB2YWw7XHJcbiAgICAgIHZhciBhbmltYXRpb25RdWV1ZSA9IFtdOyAvLyB1c2VkIHRvIHN0b3JlIGFsbCB0aGUgYW5pbWF0aW9uIHBhcmFtcyBiZWZvcmUgc3RhcnRpbmcgdGhlIGFuaW1hdGlvbjtcclxuICAgICAgLy8gc29sdmVzIGluaXRpYWwgYW5pbWF0aW9uIHNsb3dkb3duc1xyXG4gICAgICB2YXIgJGNvbGxlY3Rpb247XHJcbiAgICAgIGlmICh0eXBlb2Yob3B0aW9ucy5hdHRyaWJ1dGUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAkY29sbGVjdGlvbiA9ICQoY29sbGVjdGlvbik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGNvbGxlY3Rpb24gPSBjbG9uZVdpdGhDYW52YXNlcygkKGNvbGxlY3Rpb24pLmZpbHRlcignWycgKyBvcHRpb25zLmF0dHJpYnV0ZSArICddJykpOyAvLyBkZXN0aW5hdGlvbiAodGFyZ2V0KSBjb2xsZWN0aW9uXHJcbiAgICAgIH1cclxuICAgICAgdmFyICRzb3VyY2VQYXJlbnQgPSAkKHRoaXMpOyAvLyBzb3VyY2UsIHRoZSB2aXNpYmxlIGNvbnRhaW5lciBvZiBzb3VyY2UgY29sbGVjdGlvblxyXG4gICAgICB2YXIgc291cmNlSGVpZ2h0ID0gJCh0aGlzKS5jc3MoJ2hlaWdodCcpOyAvLyB1c2VkIHRvIGtlZXAgaGVpZ2h0IGFuZCBkb2N1bWVudCBmbG93IGR1cmluZyB0aGUgYW5pbWF0aW9uXHJcbiAgICAgIHZhciBzb3VyY2VXaWR0aCA9ICQodGhpcykuY3NzKCd3aWR0aCcpOyAvLyB1c2VkIHRvIGtlZXAgIHdpZHRoIGFuZCBkb2N1bWVudCBmbG93IGR1cmluZyB0aGUgYW5pbWF0aW9uXHJcbiAgICAgIHZhciBkZXN0SGVpZ2h0LCBkZXN0V2lkdGg7XHJcbiAgICAgIHZhciBhZGp1c3RIZWlnaHRPbkNhbGxiYWNrID0gZmFsc2U7XHJcbiAgICAgIHZhciBhZGp1c3RXaWR0aE9uQ2FsbGJhY2sgPSBmYWxzZTtcclxuICAgICAgdmFyIG9mZnNldCA9ICQoJHNvdXJjZVBhcmVudCkub2Zmc2V0KCk7IC8vIG9mZnNldCBvZiB2aXNpYmxlIGNvbnRhaW5lciwgdXNlZCBpbiBhbmltYXRpb24gY2FsY3VsYXRpb25zXHJcbiAgICAgIHZhciBvZmZzZXRzID0gW107IC8vIGNvb3JkaW5hdGVzIG9mIGV2ZXJ5IHNvdXJjZSBjb2xsZWN0aW9uIGl0ZW1cclxuICAgICAgdmFyICRzb3VyY2UgPSAkKHRoaXMpLmZpbmQob3B0aW9ucy5zZWxlY3Rvcik7IC8vIHNvdXJjZSBjb2xsZWN0aW9uIGl0ZW1zXHJcbiAgICAgIHZhciB3aWR0aCA9ICQoJHNvdXJjZSkuaW5uZXJXaWR0aCgpOyAvLyBuZWVkIGZvciB0aGUgcmVzcG9uc2l2ZSBkZXNpZ25cclxuXHJcbiAgICAgIC8vIFJlcGxhY2UgdGhlIGNvbGxlY3Rpb24gYW5kIHF1aXQgaWYgSUU2XHJcbiAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9tc2llIFs2XS9pKSkge1xyXG4gICAgICAgICRzb3VyY2VQYXJlbnQuaHRtbCgnJykuYXBwZW5kKCRjb2xsZWN0aW9uKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldHMgY2FsbGVkIHdoZW4gYW55IGFuaW1hdGlvbiBpcyBmaW5pc2hlZFxyXG4gICAgICB2YXIgcG9zdENhbGxiYWNrUGVyZm9ybWVkID0gMDsgLy8gcHJldmVudHMgdGhlIGZ1bmN0aW9uIGZyb20gYmVpbmcgY2FsbGVkIG1vcmUgdGhhbiBvbmUgdGltZVxyXG4gICAgICB2YXIgcG9zdENhbGxiYWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5jc3MoJ21hcmdpbicsICcnKS5jc3MoJ3Bvc2l0aW9uJywgJycpLmNzcygndG9wJywgJycpLmNzcygnbGVmdCcsICcnKS5jc3MoJ29wYWNpdHknLCAnJyk7XHJcbiAgICAgICAgaWYgKCFwb3N0Q2FsbGJhY2tQZXJmb3JtZWQpIHtcclxuICAgICAgICAgIHBvc3RDYWxsYmFja1BlcmZvcm1lZCA9IDE7XHJcblxyXG4gICAgICAgICAgaWYgKCFvcHRpb25zLmF0b21pYykge1xyXG4gICAgICAgICAgICAvLyBoYWNrOiB1c2VkIHRvIGJlOiAkc291cmNlUGFyZW50Lmh0bWwoJGRlc3QuaHRtbCgpKTtcclxuICAgICAgICAgICAgLy8gcHV0IHRhcmdldCBIVE1MIGludG8gdmlzaWJsZSBzb3VyY2UgY29udGFpbmVyXHJcbiAgICAgICAgICAgIC8vIGJ1dCBuZXcgd2Via2l0IGJ1aWxkcyBjYXVzZSBmbGlja2VyaW5nIHdoZW4gcmVwbGFjaW5nIHRoZSBjb2xsZWN0aW9uc1xyXG4gICAgICAgICAgICB2YXIgJHRvRGVsZXRlID0gJHNvdXJjZVBhcmVudC5maW5kKG9wdGlvbnMuc2VsZWN0b3IpO1xyXG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMucmV0YWluRXhpc3RpbmcpIHtcclxuICAgICAgICAgICAgICAkc291cmNlUGFyZW50LnByZXBlbmQoJGRlc3QuZmluZChvcHRpb25zLnNlbGVjdG9yKSk7XHJcbiAgICAgICAgICAgICAgJHRvRGVsZXRlLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vIEF2b2lkIHJlcGxhY2luZyBlbGVtZW50cyBiZWNhdXNlIHdlIG1heSBoYXZlIGFscmVhZHkgYWx0ZXJlZCBpdGVtcyBpbiBzaWduaWZpY2FudFxyXG4gICAgICAgICAgICAgIC8vIHdheXMgYW5kIGl0IHdvdWxkIGJlIGJhZCB0byBoYXZlIHRvIGRvIGl0IGFnYWluLiAoaS5lLiBsYXp5IGxvYWQgaW1hZ2VzKVxyXG4gICAgICAgICAgICAgIC8vIEJ1dCAkZGVzdCBob2xkcyB0aGUgY29ycmVjdCBvcmRlcmluZy4gU28gd2UgbXVzdCByZS1zZXF1ZW5jZSBpdGVtcyBpbiAkc291cmNlUGFyZW50IHRvIG1hdGNoLlxyXG4gICAgICAgICAgICAgIHZhciAka2VlcEVsZW1lbnRzID0gJChbXSk7XHJcbiAgICAgICAgICAgICAgJGRlc3QuZmluZChvcHRpb25zLnNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uKGkpIHtcclxuICAgICAgICAgICAgICAgIHZhciAkbWF0Y2hlZEVsZW1lbnQgPSAkKFtdKTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKG9wdGlvbnMuYXR0cmlidXRlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSBvcHRpb25zLmF0dHJpYnV0ZSgkKHRoaXMpKTtcclxuICAgICAgICAgICAgICAgICAgJHRvRGVsZXRlLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXR0cmlidXRlKHRoaXMpID09IHZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJG1hdGNoZWRFbGVtZW50ID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJG1hdGNoZWRFbGVtZW50ID0gJHRvRGVsZXRlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAnWycgKyBvcHRpb25zLmF0dHJpYnV0ZSArICc9XCInK1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihvcHRpb25zLmF0dHJpYnV0ZSkgKyAnXCJdJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJG1hdGNoZWRFbGVtZW50Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgYSBtYXRjaGluZyBlbGVtZW50IGluIHRoZSAkdG9EZWxldGUgbGlzdCBhbmQgaW4gJGRlc3RcclxuICAgICAgICAgICAgICAgICAgLy8gbGlzdCwgc28gbWFrZSBzdXJlIGl0IGlzIGluIHRoZSByaWdodCBsb2NhdGlvbiB3aXRoaW4gJHNvdXJjZVBhcmVudFxyXG4gICAgICAgICAgICAgICAgICAvLyBhbmQgcHV0IGl0IGluIHRoZSBsaXN0IG9mIGVsZW1lbnRzIHdlIG5lZWQgdG8gbm90IGRlbGV0ZS5cclxuICAgICAgICAgICAgICAgICAgJGtlZXBFbGVtZW50cyA9ICRrZWVwRWxlbWVudHMuYWRkKCRtYXRjaGVkRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNvdXJjZVBhcmVudC5wcmVwZW5kKCRtYXRjaGVkRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1hdGNoZWRFbGVtZW50Lmluc2VydEFmdGVyKCRzb3VyY2VQYXJlbnQuZmluZChvcHRpb25zLnNlbGVjdG9yKS5nZXQoaSAtIDEpKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIC8vIFJlbW92ZSB3aGF0ZXZlciBpcyByZW1haW5pbmcgZnJvbSB0aGUgRE9NXHJcbiAgICAgICAgICAgICAgJHRvRGVsZXRlLm5vdCgka2VlcEVsZW1lbnRzKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGFkanVzdEhlaWdodE9uQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAkc291cmNlUGFyZW50LmNzcygnaGVpZ2h0JywgZGVzdEhlaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFkanVzdFdpZHRoT25DYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICRzb3VyY2VQYXJlbnQuY3NzKCd3aWR0aCcsIHNvdXJjZVdpZHRoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgb3B0aW9ucy5lbmhhbmNlbWVudCgkc291cmNlUGFyZW50KTsgLy8gUGVyZm9ybSBjdXN0b20gdmlzdWFsIGVuaGFuY2VtZW50cyBvbiBhIG5ld2x5IHJlcGxhY2VkIGNvbGxlY3Rpb25cclxuICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2tGdW5jdGlvbiA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24uY2FsbCh0aGF0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgnYXV0bycgPT09IG9wdGlvbnMuYWRqdXN0SGVpZ2h0KSB7XHJcbiAgICAgICAgICAkc291cmNlUGFyZW50LmNzcygnaGVpZ2h0JywgJ2F1dG8nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgnYXV0bycgPT09IG9wdGlvbnMuYWRqdXN0V2lkdGgpIHtcclxuICAgICAgICAgICRzb3VyY2VQYXJlbnQuY3NzKCd3aWR0aCcsICdhdXRvJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gUG9zaXRpb246IHJlbGF0aXZlIHNpdHVhdGlvbnNcclxuICAgICAgdmFyICRjb3JyZWN0aW9uUGFyZW50ID0gJHNvdXJjZVBhcmVudC5vZmZzZXRQYXJlbnQoKTtcclxuICAgICAgdmFyIGNvcnJlY3Rpb25PZmZzZXQgPSAkY29ycmVjdGlvblBhcmVudC5vZmZzZXQoKTtcclxuICAgICAgaWYgKCRjb3JyZWN0aW9uUGFyZW50LmNzcygncG9zaXRpb24nKSA9PSAncmVsYXRpdmUnKSB7XHJcbiAgICAgICAgaWYgKCRjb3JyZWN0aW9uUGFyZW50LmdldCgwKS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9ICdib2R5Jykge1xyXG4gICAgICAgICAgY29ycmVjdGlvbk9mZnNldC50b3AgKz0gKHBhcnNlRmxvYXQoJGNvcnJlY3Rpb25QYXJlbnQuY3NzKCdib3JkZXItdG9wLXdpZHRoJykpIHx8IDApO1xyXG4gICAgICAgICAgY29ycmVjdGlvbk9mZnNldC5sZWZ0ICs9IChwYXJzZUZsb2F0KCRjb3JyZWN0aW9uUGFyZW50LmNzcygnYm9yZGVyLWxlZnQtd2lkdGgnKSkgfHwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvcnJlY3Rpb25PZmZzZXQudG9wIC09IChwYXJzZUZsb2F0KCRjb3JyZWN0aW9uUGFyZW50LmNzcygnYm9yZGVyLXRvcC13aWR0aCcpKSB8fCAwKTtcclxuICAgICAgICBjb3JyZWN0aW9uT2Zmc2V0LmxlZnQgLT0gKHBhcnNlRmxvYXQoJGNvcnJlY3Rpb25QYXJlbnQuY3NzKCdib3JkZXItbGVmdC13aWR0aCcpKSB8fCAwKTtcclxuICAgICAgICBjb3JyZWN0aW9uT2Zmc2V0LnRvcCAtPSAocGFyc2VGbG9hdCgkY29ycmVjdGlvblBhcmVudC5jc3MoJ21hcmdpbi10b3AnKSkgfHwgMCk7XHJcbiAgICAgICAgY29ycmVjdGlvbk9mZnNldC5sZWZ0IC09IChwYXJzZUZsb2F0KCRjb3JyZWN0aW9uUGFyZW50LmNzcygnbWFyZ2luLWxlZnQnKSkgfHwgMCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHBlcmZvcm0gY3VzdG9tIGNvcnJlY3Rpb25zIGZyb20gb3B0aW9ucyAodXNlIHdoZW4gUXVpY2tzYW5kIGZhaWxzIHRvIGRldGVjdCBwcm9wZXIgY29ycmVjdGlvbilcclxuICAgICAgaWYgKGlzTmFOKGNvcnJlY3Rpb25PZmZzZXQubGVmdCkpIHtcclxuICAgICAgICBjb3JyZWN0aW9uT2Zmc2V0LmxlZnQgPSAwO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpc05hTihjb3JyZWN0aW9uT2Zmc2V0LnRvcCkpIHtcclxuICAgICAgICBjb3JyZWN0aW9uT2Zmc2V0LnRvcCA9IDA7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvcnJlY3Rpb25PZmZzZXQubGVmdCAtPSBvcHRpb25zLmR4O1xyXG4gICAgICBjb3JyZWN0aW9uT2Zmc2V0LnRvcCAtPSBvcHRpb25zLmR5O1xyXG5cclxuICAgICAgLy8ga2VlcHMgbm9kZXMgYWZ0ZXIgc291cmNlIGNvbnRhaW5lciwgaG9sZGluZyB0aGVpciBwb3NpdGlvblxyXG4gICAgICBpZiAob3B0aW9ucy5hZGp1c3RIZWlnaHQgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgJHNvdXJjZVBhcmVudC5jc3MoJ2hlaWdodCcsICQodGhpcykuaGVpZ2h0KCkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLmFkanVzdFdpZHRoICE9PSBmYWxzZSkge1xyXG4gICAgICAgICRzb3VyY2VQYXJlbnQuY3NzKCd3aWR0aCcsICQodGhpcykud2lkdGgoKSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGdldCBwb3NpdGlvbnMgb2Ygc291cmNlIGNvbGxlY3Rpb25zXHJcbiAgICAgICRzb3VyY2UuZWFjaChmdW5jdGlvbihpKSB7XHJcbiAgICAgICAgb2Zmc2V0c1tpXSA9ICQodGhpcykub2Zmc2V0KCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gc3RvcHMgcHJldmlvdXMgYW5pbWF0aW9ucyBvbiBzb3VyY2UgY29udGFpbmVyXHJcbiAgICAgICQodGhpcykuc3RvcCgpO1xyXG4gICAgICB2YXIgZHggPSAwO1xyXG4gICAgICB2YXIgZHkgPSAwO1xyXG4gICAgICAkc291cmNlLmVhY2goZnVuY3Rpb24oaSkge1xyXG4gICAgICAgICQodGhpcykuc3RvcCgpOyAvLyBzdG9wIGFuaW1hdGlvbiBvZiBjb2xsZWN0aW9uIGl0ZW1zXHJcbiAgICAgICAgdmFyIHJhd09iaiA9ICQodGhpcykuZ2V0KDApO1xyXG4gICAgICAgIGlmIChyYXdPYmouc3R5bGUucG9zaXRpb24gPT0gJ2Fic29sdXRlJykge1xyXG4gICAgICAgICAgZHggPSAtb3B0aW9ucy5keDtcclxuICAgICAgICAgIGR5ID0gLW9wdGlvbnMuZHk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGR4ID0gb3B0aW9ucy5keDtcclxuICAgICAgICAgIGR5ID0gb3B0aW9ucy5keTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJhd09iai5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICAgICAgcmF3T2JqLnN0eWxlLm1hcmdpbiA9ICcwJztcclxuXHJcbiAgICAgICAgaWYgKCFvcHRpb25zLmFkanVzdFdpZHRoKSB7XHJcbiAgICAgICAgICByYXdPYmouc3R5bGUud2lkdGggPSAod2lkdGggKyAncHgnKTsgLy8gc2V0cyB0aGUgd2lkdGggdG8gdGhlIGN1cnJlbnQgZWxlbWVudFxyXG4gICAgICAgICAgLy8gd2l0aCBldmVuIGlmIGl0IGhhcyBiZWVuIGNoYW5nZWRcclxuICAgICAgICAgIC8vIGJ5IGEgcmVzcG9uc2l2ZSBkZXNpZ25cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJhd09iai5zdHlsZS50b3AgPSAob2Zmc2V0c1tpXS50b3AtIHBhcnNlRmxvYXQocmF3T2JqLnN0eWxlLm1hcmdpblRvcCkgLSBjb3JyZWN0aW9uT2Zmc2V0LnRvcCArIGR5KSArICdweCc7XHJcbiAgICAgICAgcmF3T2JqLnN0eWxlLmxlZnQgPSAob2Zmc2V0c1tpXS5sZWZ0LSBwYXJzZUZsb2F0KHJhd09iai5zdHlsZS5tYXJnaW5MZWZ0KSAtIGNvcnJlY3Rpb25PZmZzZXQubGVmdCArIGR4KSArICdweCc7XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLm1heFdpZHRoID4gMCAmJiBvZmZzZXRzW2ldLmxlZnQgPiBvcHRpb25zLm1heFdpZHRoKSB7XHJcbiAgICAgICAgICByYXdPYmouc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gY3JlYXRlIHRlbXBvcmFyeSBjb250YWluZXIgd2l0aCBkZXN0aW5hdGlvbiBjb2xsZWN0aW9uXHJcbiAgICAgIHZhciAkZGVzdCA9IGNsb25lV2l0aENhbnZhc2VzKCQoJHNvdXJjZVBhcmVudCkpO1xyXG4gICAgICB2YXIgcmF3RGVzdCA9ICRkZXN0LmdldCgwKTtcclxuICAgICAgcmF3RGVzdC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgcmF3RGVzdC5zZXRBdHRyaWJ1dGUoJ2lkJywgJycpO1xyXG4gICAgICByYXdEZXN0LnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuICAgICAgcmF3RGVzdC5zdHlsZS53aWR0aCA9ICRzb3VyY2VQYXJlbnQud2lkdGgoKSArICdweCc7XHJcbiAgICAgICRkZXN0LmFwcGVuZCgkY29sbGVjdGlvbik7XHJcbiAgICAgIC8vIEluc2VydHMgbm9kZSBpbnRvIEhUTUwuIE5vdGUgdGhhdCB0aGUgbm9kZSBpcyB1bmRlciB2aXNpYmxlIHNvdXJjZSBjb250YWluZXIgaW4gdGhlIGV4YWN0bHkgc2FtZSBwb3NpdGlvblxyXG4gICAgICAvLyBUaGUgYnJvd3NlciByZW5kZXIgYWxsIHRoZSBpdGVtcyB3aXRob3V0IHNob3dpbmcgdGhlbSAob3BhY2l0eTogMC4wKSBObyBvZmZzZXQgY2FsY3VsYXRpb25zIGFyZSBuZWVkZWQsXHJcbiAgICAgIC8vIHRoZSBicm93c2VyIGp1c3QgZXh0cmFjdHMgcG9zaXRpb24gZnJvbSB1bmRlcmxheWVyZWQgZGVzdGluYXRpb24gaXRlbXMgYW5kIHNldHMgYW5pbWF0aW9uIHRvIGRlc3RpbmF0aW9uIHBvc2l0aW9ucy5cclxuICAgICAgJGRlc3QuaW5zZXJ0QmVmb3JlKCRzb3VyY2VQYXJlbnQpO1xyXG4gICAgICAkZGVzdC5jc3MoJ29wYWNpdHknLCAwLjApO1xyXG4gICAgICByYXdEZXN0LnN0eWxlLnpJbmRleCA9IC0xO1xyXG5cclxuICAgICAgcmF3RGVzdC5zdHlsZS5tYXJnaW4gPSAnMCc7XHJcbiAgICAgIHJhd0Rlc3Quc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICByYXdEZXN0LnN0eWxlLnRvcCA9IG9mZnNldC50b3AgLSBjb3JyZWN0aW9uT2Zmc2V0LnRvcCArICdweCc7XHJcbiAgICAgIHJhd0Rlc3Quc3R5bGUubGVmdCA9IG9mZnNldC5sZWZ0IC0gY29ycmVjdGlvbk9mZnNldC5sZWZ0ICsgJ3B4JztcclxuXHJcbiAgICAgIGlmIChvcHRpb25zLmFkanVzdEhlaWdodCA9PT0gJ2R5bmFtaWMnKSB7XHJcbiAgICAgICAgLy8gSWYgZGVzdGluYXRpb24gY29udGFpbmVyIGhhcyBkaWZmZXJlbnQgaGVpZ2h0IHRoYW4gc291cmNlIGNvbnRhaW5lciB0aGUgaGVpZ2h0IGNhbiBiZSBhbmltYXRlZCxcclxuICAgICAgICAvLyBhZGp1c3RpbmcgaXQgdG8gZGVzdGluYXRpb24gaGVpZ2h0XHJcbiAgICAgICAgJHNvdXJjZVBhcmVudC5hbmltYXRlKHsgaGVpZ2h0IDogJGRlc3QuaGVpZ2h0KCkgfSwgb3B0aW9ucy5kdXJhdGlvbiwgb3B0aW9ucy5lYXNpbmcpO1xyXG4gICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuYWRqdXN0SGVpZ2h0ID09PSAnY2FsbCcpIHtcclxuICAgICAgICBkZXN0SGVpZ2h0ID0gJGRlc3QuaGVpZ2h0KCk7XHJcbiAgICAgICAgaWYgKHBhcnNlRmxvYXQoc291cmNlSGVpZ2h0KSA8IHBhcnNlRmxvYXQoZGVzdEhlaWdodCkpIHtcclxuICAgICAgICAgIC8vIEFkanVzdCB0aGUgaGVpZ2h0IG5vdyBzbyB0aGF0IHRoZSBpdGVtcyBkb24ndCBtb3ZlIG91dCBvZiB0aGUgY29udGFpbmVyXHJcbiAgICAgICAgICAkc291cmNlUGFyZW50LmNzcygnaGVpZ2h0JywgZGVzdEhlaWdodCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIEFkanVzdCBsYXRlciwgb24gY2FsbGJhY2tcclxuICAgICAgICAgIGFkanVzdEhlaWdodE9uQ2FsbGJhY2sgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG9wdGlvbnMuYWRqdXN0V2lkdGggPT09ICdkeW5hbWljJykge1xyXG4gICAgICAgIC8vIElmIGRlc3RpbmF0aW9uIGNvbnRhaW5lciBoYXMgZGlmZmVyZW50IHdpZHRoIHRoYW4gc291cmNlIGNvbnRhaW5lciB0aGUgd2lkdGggY2FuIGJlIGFuaW1hdGVkLFxyXG4gICAgICAgIC8vIGFkanVzdGluZyBpdCB0byBkZXN0aW5hdGlvbiB3aWR0aFxyXG4gICAgICAgICRzb3VyY2VQYXJlbnQuYW5pbWF0ZSh7IHdpZHRoIDogJGRlc3Qud2lkdGgoKSB9LCBvcHRpb25zLmR1cmF0aW9uLCBvcHRpb25zLmVhc2luZyk7XHJcbiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5hZGp1c3RXaWR0aCA9PT0gJ2NhbGwnKSB7XHJcbiAgICAgICAgZGVzdFdpZHRoID0gJGRlc3Qud2lkdGgoKTtcclxuICAgICAgICBpZiAocGFyc2VGbG9hdChzb3VyY2VXaWR0aCkgPCBwYXJzZUZsb2F0KGRlc3RXaWR0aCkpIHtcclxuICAgICAgICAgIC8vIEFkanVzdCB0aGUgaGVpZ2h0IG5vdyBzbyB0aGF0IHRoZSBpdGVtcyBkb24ndCBtb3ZlIG91dCBvZiB0aGUgY29udGFpbmVyXHJcbiAgICAgICAgICAkc291cmNlUGFyZW50LmNzcygnd2lkdGgnLCBkZXN0V2lkdGgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBBZGp1c3QgbGF0ZXIsIG9uIGNhbGxiYWNrXHJcbiAgICAgICAgICBhZGp1c3RXaWR0aE9uQ2FsbGJhY2sgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTm93IGl0J3MgdGltZSB0byBkbyBzaHVmZmxpbmcgYW5pbWF0aW9uLiBGaXJzdCBvZiBhbGwsIHdlIG5lZWQgdG8gaWRlbnRpZnkgc2FtZSBlbGVtZW50cyB3aXRoaW5cclxuICAgICAgLy8gc291cmNlIGFuZCBkZXN0aW5hdGlvbiBjb2xsZWN0aW9uc1xyXG4gICAgICAkc291cmNlLmVhY2goZnVuY3Rpb24oaSkge1xyXG4gICAgICAgIHZhciBkZXN0RWxlbWVudCA9IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgKG9wdGlvbnMuYXR0cmlidXRlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICB2YWwgPSBvcHRpb25zLmF0dHJpYnV0ZSgkKHRoaXMpKTtcclxuICAgICAgICAgICRjb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZSh0aGlzKSA9PSB2YWwpIHtcclxuICAgICAgICAgICAgICBkZXN0RWxlbWVudCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZGVzdEVsZW1lbnQgPSAkY29sbGVjdGlvbi5maWx0ZXIoJ1snICsgb3B0aW9ucy5hdHRyaWJ1dGUgKyAnPVwiJyArICQodGhpcykuYXR0cihvcHRpb25zLmF0dHJpYnV0ZSkgKyAnXCJdJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZXN0RWxlbWVudC5sZW5ndGgpIHtcclxuICAgICAgICAgIC8vIFRoZSBpdGVtIGlzIGJvdGggaW4gc291cmNlIGFuZCBkZXN0aW5hdGlvbiBjb2xsZWN0aW9ucy4gSXQgaXQncyB1bmRlciBkaWZmZXJlbnQgcG9zaXRpb24sIGxldCdzIG1vdmUgaXRcclxuICAgICAgICAgIGlmICghb3B0aW9ucy51c2VTY2FsaW5nKSB7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvblF1ZXVlLnB1c2goe1xyXG4gICAgICAgICAgICAgIGVsZW1lbnQgOiAkKHRoaXMpLCBkZXN0IDogZGVzdEVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgc3R5bGUgOiB7XHJcbiAgICAgICAgICAgICAgICB0b3AgOiAkKHRoaXMpLm9mZnNldCgpLnRvcCxcclxuICAgICAgICAgICAgICAgIGxlZnQgOiAkKHRoaXMpLm9mZnNldCgpLmxlZnQsXHJcbiAgICAgICAgICAgICAgICBvcGFjaXR5IDogXCJcIlxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgYW5pbWF0aW9uIDoge1xyXG4gICAgICAgICAgICAgICAgdG9wIDogZGVzdEVsZW1lbnQub2Zmc2V0KCkudG9wIC0gY29ycmVjdGlvbk9mZnNldC50b3AsXHJcbiAgICAgICAgICAgICAgICBsZWZ0IDogZGVzdEVsZW1lbnQub2Zmc2V0KCkubGVmdCAtIGNvcnJlY3Rpb25PZmZzZXQubGVmdCxcclxuICAgICAgICAgICAgICAgIG9wYWNpdHkgOiAxLjBcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uUXVldWUucHVzaCh7XHJcbiAgICAgICAgICAgICAgZWxlbWVudCA6ICQodGhpcyksIGRlc3QgOiBkZXN0RWxlbWVudCxcclxuICAgICAgICAgICAgICBzdHlsZSA6IHtcclxuICAgICAgICAgICAgICAgIHRvcCA6ICQodGhpcykub2Zmc2V0KCkudG9wLFxyXG4gICAgICAgICAgICAgICAgbGVmdCA6ICQodGhpcykub2Zmc2V0KCkubGVmdCxcclxuICAgICAgICAgICAgICAgIG9wYWNpdHkgOiBcIlwiXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBhbmltYXRpb24gOiB7XHJcbiAgICAgICAgICAgICAgICB0b3AgOiBkZXN0RWxlbWVudC5vZmZzZXQoKS50b3AgLSBjb3JyZWN0aW9uT2Zmc2V0LnRvcCxcclxuICAgICAgICAgICAgICAgIGxlZnQgOiBkZXN0RWxlbWVudC5vZmZzZXQoKS5sZWZ0IC0gY29ycmVjdGlvbk9mZnNldC5sZWZ0LFxyXG4gICAgICAgICAgICAgICAgb3BhY2l0eSA6IDEuMCxcclxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybSA6ICdzY2FsZSgxLjApJ1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIFRoZSBpdGVtIGZyb20gc291cmNlIGNvbGxlY3Rpb24gaXMgbm90IHByZXNlbnQgaW4gZGVzdGluYXRpb24gY29sbGVjdGlvbnMuICBMZXQncyByZW1vdmUgaXRcclxuICAgICAgICAgIGlmICghb3B0aW9ucy51c2VTY2FsaW5nKSB7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvblF1ZXVlLnB1c2goe1xyXG4gICAgICAgICAgICAgIGVsZW1lbnQgOiAkKHRoaXMpLFxyXG4gICAgICAgICAgICAgIHN0eWxlIDoge1xyXG4gICAgICAgICAgICAgICAgdG9wIDogJCh0aGlzKS5vZmZzZXQoKS50b3AsXHJcbiAgICAgICAgICAgICAgICBsZWZ0IDogJCh0aGlzKS5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgICAgICAgb3BhY2l0eSA6IFwiXCJcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGFuaW1hdGlvbiA6IHtcclxuICAgICAgICAgICAgICAgIG9wYWNpdHkgOiAnMC4wJ1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhbmltYXRpb25RdWV1ZS5wdXNoKHtcclxuICAgICAgICAgICAgICBlbGVtZW50IDogJCh0aGlzKSxcclxuICAgICAgICAgICAgICBzdHlsZSA6IHtcclxuICAgICAgICAgICAgICAgIHRvcCA6ICQodGhpcykub2Zmc2V0KCkudG9wLFxyXG4gICAgICAgICAgICAgICAgbGVmdCA6ICQodGhpcykub2Zmc2V0KCkubGVmdCxcclxuICAgICAgICAgICAgICAgIG9wYWNpdHkgOiBcIlwiXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBhbmltYXRpb24gOiB7XHJcbiAgICAgICAgICAgICAgICBvcGFjaXR5IDogJzAuMCcsXHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gOiAnc2NhbGUoMC4wKSdcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAkY29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uKGkpIHtcclxuICAgICAgICAvLyBHcmFiIGFsbCBpdGVtcyBmcm9tIHRhcmdldCBjb2xsZWN0aW9uIG5vdCBwcmVzZW50IGluIHZpc2libGUgc291cmNlIGNvbGxlY3Rpb25cclxuICAgICAgICB2YXIgc291cmNlRWxlbWVudCA9IFtdO1xyXG4gICAgICAgIHZhciBkZXN0RWxlbWVudCA9IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgKG9wdGlvbnMuYXR0cmlidXRlKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICB2YWwgPSBvcHRpb25zLmF0dHJpYnV0ZSgkKHRoaXMpKTtcclxuICAgICAgICAgICRzb3VyY2UuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXR0cmlidXRlKHRoaXMpID09IHZhbCkge1xyXG4gICAgICAgICAgICAgIHNvdXJjZUVsZW1lbnQgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgJGNvbGxlY3Rpb24uZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXR0cmlidXRlKHRoaXMpID09IHZhbCkge1xyXG4gICAgICAgICAgICAgIGRlc3RFbGVtZW50ID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBzb3VyY2VFbGVtZW50ID0gJHNvdXJjZS5maWx0ZXIoJ1snICsgb3B0aW9ucy5hdHRyaWJ1dGUgKyAnPVwiJyArICQodGhpcykuYXR0cihvcHRpb25zLmF0dHJpYnV0ZSkgKyAnXCJdJyk7XHJcbiAgICAgICAgICBkZXN0RWxlbWVudCA9ICRjb2xsZWN0aW9uLmZpbHRlcignWycgKyBvcHRpb25zLmF0dHJpYnV0ZSArICc9XCInICsgJCh0aGlzKS5hdHRyKG9wdGlvbnMuYXR0cmlidXRlKSArICdcIl0nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBhbmltYXRpb25PcHRpb25zO1xyXG4gICAgICAgIGlmIChzb3VyY2VFbGVtZW50Lmxlbmd0aCA9PT0gMCAmJiBkZXN0RWxlbWVudC5sZW5ndGggPiAwKSB7XHJcblxyXG4gICAgICAgICAgLy8gTm8gc3VjaCBlbGVtZW50IGluIHNvdXJjZSBjb2xsZWN0aW9uLi4uXHJcbiAgICAgICAgICBpZiAoIW9wdGlvbnMudXNlU2NhbGluZykge1xyXG4gICAgICAgICAgICBhbmltYXRpb25PcHRpb25zID0ge29wYWNpdHkgOiAnMS4wJ307XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhbmltYXRpb25PcHRpb25zID0ge29wYWNpdHkgOiAnMS4wJywgdHJhbnNmb3JtIDogJ3NjYWxlKDEuMCknfTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBMZXQncyBjcmVhdGUgaXRcclxuICAgICAgICAgIHZhciBkID0gY2xvbmVXaXRoQ2FudmFzZXMoZGVzdEVsZW1lbnQpO1xyXG4gICAgICAgICAgdmFyIHJhd0Rlc3RFbGVtZW50ID0gZC5nZXQoMCk7XHJcbiAgICAgICAgICByYXdEZXN0RWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICAgICAgICByYXdEZXN0RWxlbWVudC5zdHlsZS5tYXJnaW4gPSAnMCc7XHJcblxyXG4gICAgICAgICAgaWYgKCFvcHRpb25zLmFkanVzdFdpZHRoKSB7XHJcbiAgICAgICAgICAgIC8vIHNldHMgdGhlIHdpZHRoIHRvIHRoZSBjdXJyZW50IGVsZW1lbnQgd2l0aCBldmVuIGlmIGl0IGhhcyBiZWVuIGNoYW5nZWQgYnkgYSByZXNwb25zaXZlIGRlc2lnblxyXG4gICAgICAgICAgICByYXdEZXN0RWxlbWVudC5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JztcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByYXdEZXN0RWxlbWVudC5zdHlsZS50b3AgPSBkZXN0RWxlbWVudC5vZmZzZXQoKS50b3AgLSBjb3JyZWN0aW9uT2Zmc2V0LnRvcCArICdweCc7XHJcbiAgICAgICAgICByYXdEZXN0RWxlbWVudC5zdHlsZS5sZWZ0ID0gZGVzdEVsZW1lbnQub2Zmc2V0KCkubGVmdCAtIGNvcnJlY3Rpb25PZmZzZXQubGVmdCArICdweCc7XHJcblxyXG4gICAgICAgICAgZC5jc3MoJ29wYWNpdHknLCAwLjApOyAvLyBJRVxyXG5cclxuICAgICAgICAgIGlmIChvcHRpb25zLnVzZVNjYWxpbmcpIHtcclxuICAgICAgICAgICAgZC5jc3MoXCJ0cmFuc2Zvcm1cIiwgXCJzY2FsZSgwLjApXCIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZC5hcHBlbmRUbygkc291cmNlUGFyZW50KTtcclxuXHJcbiAgICAgICAgICBpZiAob3B0aW9ucy5tYXhXaWR0aCA9PT0gMCB8fCBkZXN0RWxlbWVudC5vZmZzZXQoKS5sZWZ0IDwgb3B0aW9ucy5tYXhXaWR0aCkge1xyXG4gICAgICAgICAgICBhbmltYXRpb25RdWV1ZS5wdXNoKHtlbGVtZW50IDogJChkKSwgZGVzdCA6IGRlc3RFbGVtZW50LGFuaW1hdGlvbiA6IGFuaW1hdGlvbk9wdGlvbnN9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgJGRlc3QucmVtb3ZlKCk7XHJcbiAgICAgIGlmICghb3B0aW9ucy5hdG9taWMpIHtcclxuICAgICAgICBvcHRpb25zLmVuaGFuY2VtZW50KCRzb3VyY2VQYXJlbnQpOyAvLyBQZXJmb3JtIGN1c3RvbSB2aXN1YWwgZW5oYW5jZW1lbnRzIGR1cmluZyB0aGUgYW5pbWF0aW9uXHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGFuaW1hdGlvblF1ZXVlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICBhbmltYXRpb25RdWV1ZVtpXS5lbGVtZW50LmFuaW1hdGUoYW5pbWF0aW9uUXVldWVbaV0uYW5pbWF0aW9uLCBvcHRpb25zLmR1cmF0aW9uLCBvcHRpb25zLmVhc2luZywgcG9zdENhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJHRvRGVsZXRlID0gJHNvdXJjZVBhcmVudC5maW5kKG9wdGlvbnMuc2VsZWN0b3IpO1xyXG4gICAgICAgICRzb3VyY2VQYXJlbnQucHJlcGVuZCgkZGVzdC5maW5kKG9wdGlvbnMuc2VsZWN0b3IpKTtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYW5pbWF0aW9uUXVldWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGlmIChhbmltYXRpb25RdWV1ZVtpXS5kZXN0ICYmIGFuaW1hdGlvblF1ZXVlW2ldLnN0eWxlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZXN0RWxlbWVudCA9IGFuaW1hdGlvblF1ZXVlW2ldLmRlc3Q7XHJcbiAgICAgICAgICAgIHZhciBkZXN0T2Zmc2V0ID0gZGVzdEVsZW1lbnQub2Zmc2V0KCk7XHJcblxyXG4gICAgICAgICAgICBkZXN0RWxlbWVudC5jc3Moe1xyXG4gICAgICAgICAgICAgIHBvc2l0aW9uIDogJ3JlbGF0aXZlJyxcclxuICAgICAgICAgICAgICB0b3AgOiAoYW5pbWF0aW9uUXVldWVbaV0uc3R5bGUudG9wIC0gZGVzdE9mZnNldC50b3ApLFxyXG4gICAgICAgICAgICAgIGxlZnQgOiAoYW5pbWF0aW9uUXVldWVbaV0uc3R5bGUubGVmdCAtIGRlc3RPZmZzZXQubGVmdClcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBkZXN0RWxlbWVudC5hbmltYXRlKHt0b3AgOiBcIjBcIiwgbGVmdCA6IFwiMFwifSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmR1cmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZWFzaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RDYWxsYmFjayk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhbmltYXRpb25RdWV1ZVtpXS5lbGVtZW50LmFuaW1hdGUoYW5pbWF0aW9uUXVldWVbaV0uYW5pbWF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kdXJhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZWFzaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdENhbGxiYWNrKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgJHRvRGVsZXRlLnJlbW92ZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG59KSk7Il19
